{# make sure that the grader entity is defined before doing all of this stuff #}
{% set grades = grader.getAllProblemGrades(app.user, problem.assignment) %}

{% set elevatedUser = grader.isTeaching(app.user, problem.assignment.section) or is_granted("ROLE_SUPER") or is_granted("ROLE_ADMIN") %}

<nav class="nav-left">

	{% if edit %}
		<a id="insert" class="btn"><div class="btn btn-center" href="">Save</div></a>
	{% endif %}
	
	
	<ol style="padding-top: 0px; padding-bottom: 10px">
		{# overview of when the assignment is due #}		
		<li><strong> {{problem.assignment.name}} 
			
			<div><small>
			{% if problem.assignment.start_time|date('U') > "now"|date('U') %}
			
				Opens: {{problem.assignment.start_time|date('M. d \\a\\t  h:i A')}}
			
			{% elseif problem.assignment.end_time|date('U') > "now"|date('U') %}
			
				Due: {{problem.assignment.end_time|date('M. d \\a\\t  h:i A')}}
			
			{% elseif problem.assignment.cutoff_time|date('U') > "now"|date('U') %}
				Due: {{problem.assignment.end_time|date('M. d \\a\\t  h:i A')}} </br>
				<i style="color: pink">Closes: {{problem.assignment.cutoff_time|date('M. d \\a\\t  h:i A')}}</i>
							
			{% else %}
			
				<i style="color: pink">Closed: {{problem.assignment.cutoff_time|date('M. d \\a\\t  h:i A')}}</i>
			
			{% endif %}
			</small></div>
		</strong></li>
		<li style="text-align:left">
			<strong>Problems</strong>
		</li>
		
		{# problem list #}
		{% for prob in problem.assignment.problems %}

			{% if prob.id != problem.id or result_page %}
			
				<a href="{{path("assignment", {'sectionId': prob.assignment.section.id, 'assignmentId': prob.assignment.id, 'problemId': prob.id})}}">
			
				<li class="sidebar" style="padding-left: 15px">			
					<div class="{% if elevatedUser %}sidebar-text{% endif %}">{{ prob.name }}&nbsp;</div>
					
					{% if usersectionrole.role.role_name == 'Takes' and (grades[prob.id]['percentage_adj'] > 0  or prob.assignment.end_time|date('U') < "now"|date('U'))%}
						<small>
							{{grades[prob.id]['passed_testcases']+grades[prob.id]['passed_extra_testcases']}}/{{grades[prob.id]['total_testcases']}}
							- 
							{{(grades[prob.id]['percentage_adj']*100)|number_format(1,'.')}}%
						</small>
					{% endif %}
					
					{% if prob.id == problem.id %}
						<div class="selectbar" style="margin: 0px; padding: 0px; position: absolute; right:0; top:0; height:100%; width:5px; background-color: #78ba62;" ></div>
					{% endif %}
				
			{% else %}
			
				<li class="sidebar" style="background: #5a5a5a; padding-left: 15px">
					<div class="{% if elevatedUser %}sidebar-text{% endif %}">{{ prob.name }}&nbsp;</div>
						{% if usersectionrole.role.role_name == 'Takes' and (grades[prob.id]['percentage_adj'] > 0  or prob.assignment.end_time|date('U') < "now"|date('U'))%}
							<small>
								{{grades[prob.id]['passed_testcases']+grades[prob.id]['passed_extra_testcases']}}/{{grades[prob.id]['total_testcases']}}
								-
								{{(grades[prob.id]['percentage_adj']*100)|number_format(1,'.')}}%
							</small>
						{% endif %}
				
					<div class="selectbar" style="margin: 0px; padding: 0px; position: absolute; right:0; top:0; height:100%; width:5px; background-color: #78ba62;" ></div>

			{% endif %}

			{# display edit icon #}
			{% if elevatedUser %}
				<object>
					<a title="Delete Problem" href="{{path('problem_delete', {'sectionId': prob.assignment.section.id, 'assignmentId': prob.assignment.id, 'problemId': prob.id})}}">
						<img class="small-icon" id="right-icon" src="{{ asset('whitetrash.png') }}">
					</a>
				</object>
				<object>
					<a title="Edit Problem" href="{{path('problem_edit', {'sectionId': prob.assignment.section.id, 'assignmentId': prob.assignment.id, 'problemId': prob.id})}}">
						<img class="small-icon" src="{{ asset('edit.png') }}">
					</a>
					
				</object>
			{% endif %}	
			
			</li>
			
			{% if prob.id != problem.id or result_page %}
			</a>
			{% endif %}
			
		{% else %}
			<li> There are no problems for this assignment </li>
		{% endfor %}
	  
	</ol>
	
	
	{% if elevatedUser %}
		<a href="{{path('problem_new', {"sectionId": section.id, 'assignmentId': assignment.id})}}" class="btn">
			<div class="btn btn-center" style="margin-top: 10px">+ Problem</div>
		</a>
		<a href="{{path('assignment_edit', {'sectionId': section.id, 'assignmentId': assignment.id})}}" class="btn">
			<div class="btn btn-center">Edit Assignment</div>
		</a>
	{% endif %}
	
</nav>
